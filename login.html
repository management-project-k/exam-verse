<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <title>Exam Verse - Login</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root{
      --primary-blue:#1a73e8;
      --error-red:#dc3545;
      --success-green:#28a745;
      --light-bg:#ffffff;
      --dark-bg:#181818;
      --dark-gray:#2a2a2a;
      --transition:all .3s ease;
    }
    body{
      font-family:'Poppins',sans-serif;
      background:var(--light-bg);
      color:#333;
      min-height:100vh;
      transition:var(--transition);
    }
    body.dark{ background:var(--dark-bg); color:#fff; }
    .login-page{ min-height:100vh; display:flex; flex-direction:column; position:relative; }
    .theme-toggle{
      position:absolute; top:24px; right:24px;
      background:none; border:none; cursor:pointer;
      width:48px; height:48px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      transition:var(--transition);
    }
    .theme-toggle:hover{ background:rgba(26,115,232,.1); }
    .theme-icon{ width:32px; height:32px; position:absolute; transition:all .4s ease; color:var(--primary-blue); }
    .sun-icon{ opacity:1; }
    body.dark .sun-icon{ opacity:0; }
    .moon-icon{ opacity:0; }
    body.dark .moon-icon{ opacity:1; }
    .login-main{ flex:1; display:flex; align-items:center; justify-content:center; padding:40px 20px; }
    .login-card{
      width:100%; max-width:400px; padding:40px;
      border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,.1);
      background:rgba(255,255,255,.95); backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,.2);
      animation:slideUp .6s ease-out;
    }
    body.dark .login-card{ 
      background:rgba(42,42,42,.95); 
      box-shadow:0 20px 60px rgba(0,0,0,.3); 
    }
    @keyframes slideUp{ from{opacity:0;transform:translateY(50px)} to{opacity:1;transform:translateY(0)} }
    .login-card h2{ text-align:center; color:var(--primary-blue); font-size:28px; font-weight:600; margin-bottom:8px; }
    .version-capsule{
      display:block; width:fit-content; margin:0 auto 24px;
      padding:6px 16px; background:rgba(26,115,232,.1);
      color:var(--primary-blue); font-size:11px; font-weight:600;
      letter-spacing:1.5px; text-transform:uppercase; border-radius:50px;
    }
    .form-group{ display:flex; flex-direction:column; gap:8px; margin-bottom:20px; }
    .form-group label{ font-weight:500; font-size:14px; }
    .form-group input{
      padding:14px 16px; border:2px solid rgba(0,0,0,.1);
      border-radius:8px; font-family:'Poppins',sans-serif;
      font-size:16px; transition:var(--transition);
      background:white;
    }
    body.dark .form-group input{ background:var(--dark-gray); color:#fff; border-color:rgba(255,255,255,.1); }
    .form-group input:focus{
      outline:none; border-color:var(--primary-blue);
      box-shadow:0 0 0 3px rgba(26,115,232,.1);
    }
    .error-message{ color:var(--error-red); font-size:12px; display:none; margin-top:4px; }
    .error-message.show{ display:block; }
    .success-message{
      color:var(--success-green); font-size:14px; text-align:center;
      background:rgba(40,167,69,.1); border-radius:8px;
      padding:12px; margin-bottom:16px; display:none;
    }
    .success-message.show{ display:block; }
    .login-btn{
      width:100%; padding:16px; background:var(--primary-blue);
      color:#fff; border:none; border-radius:8px;
      font-weight:600; cursor:pointer; transition:var(--transition);
      margin-top:8px; margin-bottom:20px; font-size:16px;
    }
    .login-btn:hover:not(:disabled){ background:#1557b0; transform:translateY(-2px); }
    .login-btn:disabled{ background:#ccc; cursor:not-allowed; opacity:0.6; }
    .forgot-password{
      text-align:center; color:var(--primary-blue);
      font-size:14px; cursor:pointer; transition:var(--transition);
      text-decoration:none; display:block;
    }
    .forgot-password:hover{ opacity:.8; }
    .loading{ display:none; text-align:center; margin-top:12px; color:var(--primary-blue); }
    .loading.show{ display:block; }
    .modal-overlay{
      display:none; position:fixed; inset:0;
      background:rgba(0,0,0,.5); z-index:1000;
      align-items:center; justify-content:center;
      backdrop-filter:blur(5px);
    }
    .modal-overlay.show{ display:flex; }
    .modal{
      background:var(--light-bg); padding:32px;
      border-radius:16px; max-width:400px; width:90%;
      box-shadow:0 20px 60px rgba(0,0,0,.3);
    }
    body.dark .modal{ background:var(--dark-gray); }
    .modal-header h3{ color:var(--primary-blue); font-size:22px; margin-bottom:8px; }
    .modal-header p{ font-size:14px; opacity:.7; margin-bottom:16px; }
    .info-row{
      background:rgba(0,0,0,.05); border-radius:8px;
      padding:12px; margin-bottom:12px;
    }
    body.dark .info-row{ background:rgba(255,255,255,.1); }
    .info-label{
      font-size:12px; font-weight:600; color:var(--primary-blue);
      text-transform:uppercase; display:block; margin-bottom:4px;
    }
    .info-value{
      font-size:15px; font-weight:500; word-break:break-all;
    }
    .btn-close{
      width:100%; background:var(--primary-blue); color:#fff;
      border:none; padding:12px; border-radius:8px;
      cursor:pointer; font-weight:600; margin-top:16px;
      font-size:15px;
    }
    .btn-close:hover{ background:#1557b0; transform:translateY(-1px); }
    .footer{
      text-align:center; padding:24px 0;
      border-top:1px solid rgba(0,0,0,.1);
    }
    body.dark .footer{ border-top-color:rgba(255,255,255,.1); }
    .footer a{ color:var(--primary-blue); text-decoration:none; font-weight:500; }
    @media (max-width:768px){
      .login-card{ padding:32px 24px; }
      .login-card h2{ font-size:24px; }
    }
  </style>
</head>
<body>
  <div class="login-page">
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Theme">
      <svg class="theme-icon sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="5"/>
        <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
        <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
      </svg>
      <svg class="theme-icon moon-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
      </svg>
    </button>
    
    <main class="login-main">
      <div class="login-card">
        <h2>Login Into<br/>Exam Verse</h2>
        <span class="version-capsule">Version 1.0</span>
        <div class="success-message" id="successMessage"></div>
        
        <form id="loginForm">
          <div class="form-group">
            <label for="rollNumber">Roll Number</label>
            <input type="text" id="rollNumber" required placeholder="Enter your roll number" autocomplete="username"/>
            <div class="error-message" id="rollNumberError"></div>
          </div>
          
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" required placeholder="Enter your password" autocomplete="current-password"/>
            <div class="error-message" id="passwordError"></div>
          </div>
          
          <button type="submit" class="login-btn" id="loginBtn">Login</button>
          <div class="loading" id="loading">Authenticating...</div>
          <a href="#" class="forgot-password" onclick="openAdminModal(); return false;">Forgot Password?</a>
        </form>
      </div>
    </main>
    
    <footer class="footer">
      <p>Designed & Developed by <a href="https://www.project-k.co.in" target="_blank">Project K</a></p>
    </footer>
  </div>

  <div class="modal-overlay" id="modalOverlay" onclick="closeAdminModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>Contact Admin</h3>
        <p>For Account Recovery Assistance</p>
      </div>
      <div class="info-row">
        <span class="info-label">Admin Name</span>
        <span class="info-value">MIDUTHURU RANGASWAMY</span>
      </div>
      <div class="info-row">
        <span class="info-label">Email ID</span>
        <span class="info-value">miduthuru.rangaswamy@gmail.com</span>
      </div>
      <button class="btn-close" onclick="closeAdminModal()">Close</button>
    </div>
  </div>

  <script>
    const LOGIN_API = '/api/login';

    let isDark = localStorage.getItem('theme') === 'dark';
    if (isDark) document.body.classList.add('dark');

    function toggleTheme() {
      isDark = !isDark;
      document.body.classList.toggle('dark', isDark);
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }

    function openAdminModal() { 
      document.getElementById('modalOverlay').classList.add('show'); 
    }
    
    function closeAdminModal(event){ 
      if (!event || event.target === document.getElementById('modalOverlay')) {
        document.getElementById('modalOverlay').classList.remove('show');
      }
    }

    document.getElementById('loginForm').addEventListener('submit', async e => {
      e.preventDefault();
      
      const roll = document.getElementById('rollNumber').value.trim();
      const pass = document.getElementById('password').value;
      const btn = document.getElementById('loginBtn');
      const rollErr = document.getElementById('rollNumberError');
      const passErr = document.getElementById('passwordError');
      const loading = document.getElementById('loading');

      // Clear previous errors
      rollErr.classList.remove('show'); 
      passErr.classList.remove('show');

      // Validate
      if (!roll) { 
        rollErr.textContent = 'Roll number is required'; 
        rollErr.classList.add('show'); 
        return; 
      }
      if (!pass) { 
        passErr.textContent = 'Password is required'; 
        passErr.classList.add('show'); 
        return; 
      }

      // Show loading
      btn.disabled = true; 
      btn.textContent = 'Logging in...';
      loading.classList.add('show');

      try {
        const res = await fetch(LOGIN_API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ rollNumber: roll, password: pass })
        });

        const result = await res.json();

        if (result.success) {
          // Store session data
          sessionStorage.setItem('currentStudent', JSON.stringify(result.data.student));
          sessionStorage.setItem('sessionId', result.data.student.SessionID);
          sessionStorage.setItem('isLoggedIn', 'true');
          localStorage.setItem('studentData', JSON.stringify(result.data.student));

          // Show success
          const msg = document.getElementById('successMessage');
          msg.textContent = 'Login successful! Redirecting...';
          msg.classList.add('show');

          // Redirect
          setTimeout(() => {
            window.location.href = 'student-dashboard.html';
          }, 1500);
        } else {
          passErr.textContent = result.message || 'Invalid credentials';
          passErr.classList.add('show');
        }
      } catch (err) {
        console.error('Login error:', err);
        passErr.textContent = 'Connection failed. Please try again.';
        passErr.classList.add('show');
      } finally {
        btn.disabled = false; 
        btn.textContent = 'Login';
        loading.classList.remove('show');
      }
    });

    // Auto-redirect if already logged in
    if (sessionStorage.getItem('isLoggedIn') === 'true') {
      window.location.href = 'student-dashboard.html';
    }
  </script>
</body>
</html>
